<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KOLIA-1517 | K·∫øt n·ªëi Ng∆∞·ªùi th√¢n</title>
    <style>
        :root {
            /* Kolia Design System Colors */
            --primary: #2BB89A;
            --primary-dark: #239B82;
            --primary-light: #E8F8F4;
            --primary-gradient: linear-gradient(135deg, #2BB89A, #1A9F82);
            --secondary-pink: #FFE4EC;
            --secondary-peach: #FFE8D6;
            --danger: #E53935;
            --danger-light: #FFEBEE;
            --warning: #FF9800;
            --warning-light: #FFF8E1;
            --text-primary: #2D3748;
            --text-secondary: #718096;
            --text-muted: #A0AEC0;
            --bg-white: #FFFFFF;
            --bg-gray: #F7FAFC;
            --bg-cream: #FFFAF5;
            --border: #E2E8F0;
            --shadow: 0 4px 15px rgba(43, 184, 154, 0.12);
            --shadow-lg: 0 8px 25px rgba(43, 184, 154, 0.18);
            --radius: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #E8F8F4 0%, #F7FAFC 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            font-size: 16px;
            line-height: 1.5;
        }

        .phone-frame {
            width: 375px;
            min-height: 667px;
            background: var(--bg-white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg), 0 10px 40px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            min-height: 600px;
        }

        .screen.active {
            display: flex;
        }

        /* Header */
        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 20px 20px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 20px;
            background: var(--bg-white);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .header-back {
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 700;
            flex: 1;
            letter-spacing: -0.3px;
        }

        /* Content */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Profile Selector */
        .profile-selector {
            background: var(--primary-gradient);
            color: white;
            padding: 20px 24px;
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .profile-selector::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30px;
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .profile-selector::after {
            content: '';
            position: absolute;
            bottom: -40%;
            left: 20%;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 1;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .profile-status {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
            position: relative;
            z-index: 1;
        }

        .dropdown-arrow {
            font-size: 20px;
        }

        /* Bottom Sheet */
        .bottom-sheet {
            display: none;
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.15);
            z-index: 100;
            max-height: 75%;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bottom-sheet.show {
            display: block;
            transform: translateY(0);
        }

        .bottom-sheet-handle {
            width: 40px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin: 12px auto 16px;
        }

        .bottom-sheet-header {
            padding: 0 20px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .bottom-sheet-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .bottom-sheet-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-gray);
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sheet-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 99;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sheet-overlay.show {
            display: block;
            opacity: 1;
        }

        .bottom-sheet-content {
            padding: 16px 20px;
        }

        .dropdown-section {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .dropdown-section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 12px;
            gap: 12px;
            cursor: pointer;
            border-radius: var(--radius);
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: var(--bg-gray);
        }

        .dropdown-item-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dropdown-item-info {
            flex: 1;
        }

        .dropdown-item-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .dropdown-item-meta {
            font-size: 12px;
            color: var(--text-muted);
        }

        .dropdown-item-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
        }

        .icon-btn.settings {
            background: var(--bg-gray);
            color: var(--text-secondary);
        }

        .icon-btn.delete {
            background: var(--danger-light);
            color: var(--danger);
        }

        /* Pending Badge Styles */
        .pending-badge {
            display: inline-block;
            background: var(--warning-light);
            color: #E65100;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .dropdown-item.pending {
            background: var(--warning-light);
            border: 1px dashed var(--warning);
        }

        .icon-btn.view {
            background: var(--primary-light);
            color: var(--primary);
        }

        .dropdown-cta {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--radius);
        }

        .dropdown-cta:hover {
            background: var(--primary-light);
        }

        .dropdown-cta-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* Invite Block */
        .invite-block {
            background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%);
            border: none;
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .invite-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 12px;
        }

        .invite-item {
            background: white;
            border-radius: var(--radius);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .invite-item-avatar {
            width: 48px;
            height: 48px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .invite-item-info {
            flex: 1;
        }

        .invite-item-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .invite-item-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .invite-actions {
            display: flex;
            gap: 8px;
        }

        .btn-accept,
        .btn-reject {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-accept:active,
        .btn-reject:active {
            transform: scale(0.95);
        }

        .btn-accept {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(43, 184, 154, 0.3);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 56px;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 16px;
            line-height: 1.6;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: var(--primary);
        }

        .form-input.error {
            border-color: var(--danger);
        }

        .form-error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        /* Button */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: var(--radius);
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 56px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(43, 184, 154, 0.25);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(43, 184, 154, 0.35);
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            background: var(--border);
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Detail Card */
        .detail-card {
            background: linear-gradient(135deg, #FFFFFF 0%, #F7FAFC 100%);
            border-radius: var(--radius-lg);
            padding: 28px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .detail-card::before {
            content: '';
            position: absolute;
            top: -40px;
            right: -40px;
            width: 100px;
            height: 100px;
            background: var(--primary-light);
            border-radius: 50%;
            opacity: 0.5;
        }

        .detail-avatar {
            width: 88px;
            height: 88px;
            background: linear-gradient(135deg, var(--primary-light) 0%, #D0F0E8 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin: 0 auto 18px;
            box-shadow: 0 4px 15px rgba(43, 184, 154, 0.2);
            position: relative;
        }

        .detail-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .detail-meta {
            font-size: 15px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        /* Permission List */
        .permission-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            padding: 18px 16px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }

        .permission-item:hover {
            transform: translateY(-2px);
        }

        .permission-info {
            flex: 1;
        }

        .permission-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 15px;
        }

        .permission-desc {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 3px;
        }

        .toggle {
            width: 50px;
            height: 28px;
            background: var(--border);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toggle.on {
            background: var(--primary);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .toggle.on::after {
            transform: translateX(22px);
        }

        /* Health Blocks */
        .health-block {
            background: linear-gradient(135deg, #FFFFFF 0%, var(--primary-light) 100%);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 14px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .health-block::after {
            content: '';
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 60px;
            height: 60px;
            background: rgba(43, 184, 154, 0.1);
            border-radius: 50%;
        }

        .health-block-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .health-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            position: relative;
        }

        .health-value small {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-muted);
            margin-left: 4px;
        }

        /* Bottom Nav */
        .bottom-nav {
            display: flex;
            background: white;
            border-top: none;
            padding: 12px 8px 20px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            position: relative;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 500;
            padding: 8px 4px;
            border-radius: var(--radius);
            transition: all 0.2s;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-icon {
            font-size: 26px;
            transition: transform 0.2s;
        }

        .nav-badge {
            position: relative;
        }

        .nav-badge::after {
            content: '3';
            position: absolute;
            top: -6px;
            right: -10px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            font-weight: 600;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(229, 57, 53, 0.4);
        }

        /* Modal */
        .modal {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            width: 100%;
            max-width: 320px;
            text-align: center;
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .modal-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
        }

        .modal-buttons .btn {
            flex: 1;
            padding: 12px;
        }

        /* Success Toast */
        .toast {
            display: none;
            position: absolute;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 16px;
            border-radius: var(--radius);
            text-align: center;
            font-weight: 500;
            z-index: 300;
        }

        .toast.show {
            display: block;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="phone-frame">
        <!-- SCR-01: K·∫øt n·ªëi Ng∆∞·ªùi th√¢n -->
        <div id="scr01" class="screen active">
            <div class="header">
                <span class="header-title">K·∫øt n·ªëi Ng∆∞·ªùi th√¢n</span>
            </div>
            <div class="content">
                <!-- Profile Selector -->
                <div class="profile-selector" onclick="toggleBottomSheet()">
                    <div class="profile-avatar">üë§</div>
                    <div class="profile-info">
                        <div class="profile-name">T√†i kho·∫£n c·ªßa [Danh x∆∞ng] <span class="dropdown-arrow">‚ñº</span></div>
                        <div class="profile-status">2 ng∆∞·ªùi theo d√µi, theo d√µi 1 ng∆∞·ªùi</div>
                    </div>
                </div>

                <!-- Pending Invites -->
                <div class="invite-block" id="inviteBlock">
                    <div class="invite-header">üì¨ L·ªùi m·ªùi m·ªõi (3)</div>
                    <div class="invite-item" data-invite-type="follow-them">
                        <div class="invite-item-avatar">üë§</div>
                        <div class="invite-item-info">
                            <div class="invite-item-name">Ch√∫ √öt (L√™ VƒÉn...)</div>
                            <div class="invite-item-desc">M·ªùi b·∫°n theo d√µi s·ª©c kh·ªèe</div>
                        </div>
                        <div class="invite-actions">
                            <button class="btn-accept"
                                onclick="event.stopPropagation(); acceptInvite('chu-ut', 'follow-them')">‚úì</button>
                            <button class="btn-reject"
                                onclick="event.stopPropagation(); rejectInvite('chu-ut')">‚úó</button>
                        </div>
                    </div>
                    <div class="invite-item" data-invite-type="follow-me">
                        <div class="invite-item-avatar">üë©</div>
                        <div class="invite-item-info">
                            <div class="invite-item-name">C√¥ Ba (Nguy·ªÖn...)</div>
                            <div class="invite-item-desc">Mu·ªën theo d√µi s·ª©c kh·ªèe c·ªßa b·∫°n</div>
                        </div>
                        <div class="invite-actions">
                            <button class="btn-accept"
                                onclick="event.stopPropagation(); acceptInvite('co-ba', 'follow-me')">‚úì</button>
                            <button class="btn-reject"
                                onclick="event.stopPropagation(); rejectInvite('co-ba')">‚úó</button>
                        </div>
                    </div>
                    <div class="invite-item" data-invite-type="follow-them">
                        <div class="invite-item-avatar">üë®</div>
                        <div class="invite-item-info">
                            <div class="invite-item-name">Anh Hai (Tr·∫ßn...)</div>
                            <div class="invite-item-desc">M·ªùi b·∫°n theo d√µi s·ª©c kh·ªèe</div>
                        </div>
                        <div class="invite-actions">
                            <button class="btn-accept"
                                onclick="event.stopPropagation(); acceptInvite('anh-hai', 'follow-them')">‚úì</button>
                            <button class="btn-reject"
                                onclick="event.stopPropagation(); rejectInvite('anh-hai')">‚úó</button>
                        </div>
                    </div>
                </div>

                <!-- Empty State when no connections -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-state-icon">üîó</div>
                    <div class="empty-state-text">Ch∆∞a c√≥ k·∫øt n·ªëi n√†o.<br>B·∫Øt ƒë·∫ßu k·∫øt n·ªëi v·ªõi ng∆∞·ªùi th√¢n ngay!
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 16px; width: 100%; max-width: 340px;">
                        <button class="btn btn-primary" style="flex: 1; padding: 12px 14px; font-size: 13px;"
                            onclick="showInviteSheet('invite')">M·ªùi ng∆∞·ªùi th√¢n theo d√µi</button>
                        <button class="btn btn-outline" style="flex: 1; padding: 12px 14px; font-size: 13px;"
                            onclick="showInviteSheet('follow')">Theo d√µi ng∆∞·ªùi th√¢n</button>
                    </div>
                </div>
            </div>

            <!-- Bottom Sheet: Danh s√°ch ng∆∞·ªùi th√¢n -->
            <div class="sheet-overlay" id="sheetOverlay" onclick="toggleBottomSheet()"></div>
            <div class="bottom-sheet" id="bottomSheet">
                <div class="bottom-sheet-handle"></div>
                <div class="bottom-sheet-header">
                    <span class="bottom-sheet-title">Danh s√°ch k·∫øt n·ªëi</span>
                    <button class="bottom-sheet-close" onclick="toggleBottomSheet()">‚úï</button>
                </div>
                <div class="bottom-sheet-content">
                    <!-- Section 1: T√îI ƒêANG THEO D√ïI -->
                    <div class="dropdown-section">
                        <div class="dropdown-section-title">üìã T√¥i ƒëang theo d√µi (1 + 1 ch·ªù)</div>
                        <!-- Connected Patient: tap ‚Üí main screen with health blocks -->
                        <div class="dropdown-item"
                            onclick="selectPatient('me', 'üëµ', 'M·∫π (Tr·∫ßn Th·ªã D)', 'Ho·∫°t ƒë·ªông 5 ph√∫t tr∆∞·ªõc')">
                            <div class="dropdown-item-avatar">üëµ</div>
                            <div class="dropdown-item-info">
                                <div class="dropdown-item-name">M·∫π (Tr·∫ßn Th·ªã D)</div>
                                <div class="dropdown-item-meta">Ho·∫°t ƒë·ªông 5 ph√∫t tr∆∞·ªõc</div>
                            </div>
                        </div>
                        <!-- Pending Follow Request (Ch·ªù ph·∫£n h·ªìi) - B3.2b: ch·ªâ c√≥ ‚ùå, kh√¥ng c√≥ ‚öôÔ∏è -->
                        <div class="dropdown-item pending">
                            <div class="dropdown-item-avatar">üë©</div>
                            <div class="dropdown-item-info">
                                <div class="dropdown-item-name">D√¨ Ba (L√™ Th·ªã B)<span class="pending-badge">‚è≥ Ch·ªù ph·∫£n
                                        h·ªìi</span></div>
                                <div class="dropdown-item-meta">ƒê√£ g·ª≠i y√™u c·∫ßu 1 ng√†y tr∆∞·ªõc</div>
                            </div>
                            <div class="dropdown-item-actions">
                                <button class="icon-btn delete"
                                    onclick="event.stopPropagation(); showCancelPendingModal('follow', 'D√¨ Ba')"
                                    title="H·ªßy y√™u c·∫ßu">‚ùå</button>
                            </div>
                        </div>
                        <div class="dropdown-cta" onclick="showInviteSheet('follow')">
                            <div class="dropdown-cta-icon">+</div>
                            <span>Th√™m ng∆∞·ªùi ƒë·ªÉ theo d√µi</span>
                        </div>
                    </div>
                    <!-- Section 2: NG∆Ø·ªúI ƒêANG THEO D√ïI T√îI -->
                    <div class="dropdown-section">
                        <div class="dropdown-section-title">üìã Ng∆∞·ªùi ƒëang theo d√µi t√¥i (2 + 1 ch·ªù)</div>
                        <!-- Connected Caregiver: tap ‚Üí SCR-04 detail screen -->
                        <div class="dropdown-item" onclick="goToScreen('scr04')">
                            <div class="dropdown-item-avatar">üë®</div>
                            <div class="dropdown-item-info">
                                <div class="dropdown-item-name">Con trai (Nguy·ªÖn VƒÉn B)</div>
                                <div class="dropdown-item-meta">Ho·∫°t ƒë·ªông 2 gi·ªù tr∆∞·ªõc</div>
                            </div>
                        </div>
                        <div class="dropdown-item" onclick="goToScreen('scr04')">
                            <div class="dropdown-item-avatar">üë©</div>
                            <div class="dropdown-item-info">
                                <div class="dropdown-item-name">Con g√°i (Nguy·ªÖn Th·ªã C)</div>
                                <div class="dropdown-item-meta">Ho·∫°t ƒë·ªông 5 ph√∫t tr∆∞·ªõc</div>
                            </div>
                        </div>
                        <!-- Pending Invite - tap ƒë·ªÉ v√†o m√†n Chi ti·∫øt (SCR-04B) -->
                        <div class="dropdown-item pending" onclick="goToScreen('scr04b')">
                            <div class="dropdown-item-avatar">üë¥</div>
                            <div class="dropdown-item-info">
                                <div class="dropdown-item-name">B√°c Hai (Nguy·ªÖn VƒÉn H)<span class="pending-badge">‚è≥ Ch·ªù
                                        ph·∫£n h·ªìi</span></div>
                                <div class="dropdown-item-meta">ƒê√£ g·ª≠i l·ªùi m·ªùi 2 gi·ªù tr∆∞·ªõc</div>
                            </div>
                            <div class="dropdown-item-actions">
                                <button class="icon-btn delete"
                                    onclick="event.stopPropagation(); showCancelPendingModal('invite', 'B√°c Hai')"
                                    title="H·ªßy l·ªùi m·ªùi">‚ùå</button>
                            </div>
                        </div>
                        <div class="dropdown-cta" onclick="showInviteSheet('invite')">
                            <div class="dropdown-cta-icon">+</div>
                            <span>Th√™m ng∆∞·ªùi theo d√µi b·∫°n</span>
                        </div>
                    </div>
                </div>
            </div>


            <div class="bottom-nav">
                <div class="nav-item"><span class="nav-icon">üè†</span><span>Trang ch·ªß</span></div>
                <div class="nav-item"><span class="nav-icon">üíä</span><span>Thu·ªëc</span></div>
                <div class="nav-item"><span class="nav-icon">üå≥</span><span>Ho·∫°t ƒë·ªông</span></div>
                <div class="nav-item active"><span class="nav-icon nav-badge">üë•</span><span>Ng∆∞·ªùi th√¢n</span></div>
                <div class="nav-item"><span class="nav-icon">‚öôÔ∏è</span><span>C√†i ƒë·∫∑t</span></div>
            </div>

            <!-- Invite Bottom Sheet -->
            <div class="sheet-overlay" id="inviteSheetOverlay" onclick="hideInviteSheet()"></div>
            <div class="bottom-sheet" id="inviteSheet">
                <div class="bottom-sheet-handle"></div>
                <div class="bottom-sheet-header">
                    <span class="bottom-sheet-title" id="inviteSheetTitle">M·ªùi ng∆∞·ªùi th√¢n theo d√µi</span>
                    <button class="bottom-sheet-close" onclick="hideInviteSheet()">‚úï</button>
                </div>
                <div class="bottom-sheet-content">
                    <p id="inviteSheetDesc"
                        style="color: var(--text-secondary); margin-bottom: 20px; font-size: 15px; line-height: 1.5;">
                        Nh·∫≠p th√¥ng tin ng∆∞·ªùi b·∫°n mu·ªën m·ªùi theo d√µi s·ª©c kh·ªèe c·ªßa b·∫°n.
                    </p>
                    <form id="inviteForm" onsubmit="event.preventDefault(); submitInvite();">
                        <div class="form-group">
                            <label class="form-label">T√™n ng∆∞·ªùi th√¢n *</label>
                            <input type="text" class="form-input" id="inviteNameInput" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A"
                                oninput="validateInviteForm()" required minlength="2">
                            <div class="form-error" id="nameError">T√™n ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
                            <input type="tel" class="form-input" id="invitePhoneInput" placeholder="V√≠ d·ª•: 0912 345 678"
                                maxlength="10" oninput="validateInviteForm()" required>
                            <div class="form-error" id="phoneError">S·ªë ƒëi·ªán tho·∫°i ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng 0 v√† c√≥ 10 s·ªë</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">M·ªëi quan h·ªá *</label>
                            <select class="form-input" id="inviteRelationship" onchange="validateInviteForm()" required>
                                <option value="">-- Ch·ªçn m·ªëi quan h·ªá --</option>
                                <option value="con_trai">Con trai</option>
                                <option value="con_gai">Con g√°i</option>
                                <option value="vo">V·ª£</option>
                                <option value="chong">Ch·ªìng</option>
                                <option value="bo">B·ªë</option>
                                <option value="me">M·∫π</option>
                                <option value="anh_trai">Anh trai</option>
                                <option value="chi_gai">Ch·ªã g√°i</option>
                                <option value="em_trai">Em trai</option>
                                <option value="em_gai">Em g√°i</option>
                                <option value="ong">√îng</option>
                                <option value="ba">B√†</option>
                                <option value="chau">Ch√°u</option>
                                <option value="khac">Kh√°c</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" id="inviteSubmitBtn" disabled>
                            Ti·∫øp t·ª•c
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- SCR-02: M·ªùi Ng∆∞·ªùi th√¢n (Invite to follow me) -->
        <div id="scr02-invite" class="screen">
            <div class="header">
                <span class="header-back" onclick="goToScreen('scr01')">‚Üê</span>
                <span class="header-title">M·ªùi ng∆∞·ªùi th√¢n theo d√µi</span>
            </div>
            <div class="content">
                <p style="color: var(--text-secondary); margin-bottom: 20px; line-height: 1.5;">
                    Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i c·ªßa ng∆∞·ªùi th√¢n ƒë·ªÉ m·ªùi h·ªç theo d√µi s·ª©c kh·ªèe c·ªßa b·∫°n.
                </p>
                <div class="form-group">
                    <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="tel" class="form-input" id="phoneInput1" placeholder="V√≠ d·ª•: 0912 345 678"
                        maxlength="10" oninput="validatePhone(this, 'phoneError1', 'inviteBtn1')">
                    <div class="form-error" id="phoneError1">S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá</div>
                </div>
                <button class="btn btn-primary" id="inviteBtn1" disabled onclick="goToPermissionConfig()">Ti·∫øp
                    t·ª•c</button>
            </div>
        </div>

        <!-- SCR-02B: C·∫•u h√¨nh quy·ªÅn tr∆∞·ªõc khi g·ª≠i l·ªùi m·ªùi -->
        <div id="scr02b-permissions" class="screen">
            <div class="header">
                <span class="header-back" onclick="backToInviteSheet()">‚Üê</span>
                <span class="header-title">Quy·ªÅn truy c·∫≠p</span>
            </div>
            <div class="content">
                <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">
                    Ch·ªçn quy·ªÅn m√† ng∆∞·ªùi ƒë∆∞·ª£c m·ªùi s·∫Ω c√≥ sau khi ch·∫•p nh·∫≠n:
                </p>

                <div class="permission-list">
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Xem t·ªïng quan s·ª©c kh·ªèe</div>
                            <div class="permission-desc">Ch·ªâ s·ªë HA, b√°o c√°o</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Nh·∫≠n c·∫£nh b√°o kh·∫©n c·∫•p</div>
                            <div class="permission-desc">C·∫£nh b√°o HA b·∫•t th∆∞·ªùng, SOS</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this, true)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Thi·∫øt l·∫≠p nhi·ªám v·ª•</div>
                            <div class="permission-desc">T·∫°o/s·ª≠a nhi·ªám v·ª• tu√¢n th·ªß</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Theo d√µi k·∫øt qu·∫£</div>
                            <div class="permission-desc">Xem l·ªãch s·ª≠ tu√¢n th·ªß</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Th·ª±c hi·ªán nhi·ªám v·ª• thay</div>
                            <div class="permission-desc">ƒê√°nh d·∫•u ho√†n th√†nh</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">G·ª≠i l·ªùi ƒë·ªông vi√™n</div>
                            <div class="permission-desc">G·ª≠i tin nh·∫Øn</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                </div>

                <button class="btn btn-primary" style="margin-top: 20px;" onclick="sendInviteWithPermissions()">G·ª≠i l·ªùi
                    m·ªùi</button>
            </div>
        </div>

        <!-- SCR-02B-ACCEPT: C·∫•u h√¨nh quy·ªÅn sau khi nh·∫≠n l·ªùi m·ªùi t·ª´ Caregiver (A2.1) -->
        <div id="scr02b-accept" class="screen">
            <div class="header">
                <span class="header-back" onclick="cancelAcceptInvite()">‚Üê</span>
                <span class="header-title">Quy·ªÅn truy c·∫≠p</span>
            </div>
            <div class="content">
                <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">
                    <strong id="acceptingInviterName">Ng∆∞·ªùi th√¢n</strong> ƒë√£ m·ªùi theo d√µi b·∫°n.<br>
                    Ch·ªçn quy·ªÅn m√† h·ªç s·∫Ω c√≥:
                </p>

                <div class="permission-list">
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Xem t·ªïng quan s·ª©c kh·ªèe</div>
                            <div class="permission-desc">Ch·ªâ s·ªë HA, b√°o c√°o</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Nh·∫≠n c·∫£nh b√°o kh·∫©n c·∫•p</div>
                            <div class="permission-desc">C·∫£nh b√°o HA b·∫•t th∆∞·ªùng, SOS</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this, true)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Thi·∫øt l·∫≠p nhi·ªám v·ª•</div>
                            <div class="permission-desc">T·∫°o/s·ª≠a nhi·ªám v·ª• tu√¢n th·ªß</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Theo d√µi k·∫øt qu·∫£</div>
                            <div class="permission-desc">Xem l·ªãch s·ª≠ tu√¢n th·ªß</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Th·ª±c hi·ªán nhi·ªám v·ª• thay</div>
                            <div class="permission-desc">ƒê√°nh d·∫•u ho√†n th√†nh</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">G·ª≠i l·ªùi ƒë·ªông vi√™n</div>
                            <div class="permission-desc">G·ª≠i tin nh·∫Øn</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                </div>

                <button class="btn btn-primary" style="margin-top: 20px;" onclick="confirmAcceptWithPermissions()">X√°c
                    nh·∫≠n k·∫øt n·ªëi</button>
            </div>
        </div>
        <!-- SCR-02: Theo d√µi ng∆∞·ªùi th√¢n -->
        <div id="scr02-follow" class="screen">
            <div class="header">
                <span class="header-back" onclick="goToScreen('scr01')">‚Üê</span>
                <span class="header-title">Theo d√µi ng∆∞·ªùi th√¢n</span>
            </div>
            <div class="content">
                <p style="color: var(--text-secondary); margin-bottom: 20px; line-height: 1.5;">
                    Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i c·ªßa ng∆∞·ªùi b·∫°n mu·ªën theo d√µi s·ª©c kh·ªèe.
                </p>
                <div class="form-group">
                    <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="tel" class="form-input" id="phoneInput2" placeholder="V√≠ d·ª•: 0912 345 678"
                        maxlength="10" oninput="validatePhone(this, 'phoneError2', 'inviteBtn2')">
                    <div class="form-error" id="phoneError2">S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá</div>
                </div>
                <button class="btn btn-primary" id="inviteBtn2" disabled onclick="sendInvite('follow')">G·ª≠i l·ªùi
                    m·ªùi</button>
            </div>
        </div>

        <!-- SCR-04: Chi ti·∫øt Caregiver -->
        <div id="scr04" class="screen">
            <div class="header">
                <span class="header-back" onclick="goToScreen('scr01')">‚Üê</span>
                <span class="header-title">Chi ti·∫øt ng∆∞·ªùi th√¢n</span>
            </div>
            <div class="content">
                <div class="detail-card">
                    <div class="detail-avatar">üë®</div>
                    <div class="detail-name">Con trai (Nguy·ªÖn VƒÉn B)</div>
                    <div class="detail-meta">Ho·∫°t ƒë·ªông 2 gi·ªù tr∆∞·ªõc</div>
                </div>

                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-outline" style="flex: 1;" onclick="goToScreen('scr05')">‚öôÔ∏è Quy·ªÅn
                        truy c·∫≠p</button>
                    <button class="btn btn-outline" style="flex: 1; color: var(--danger);"
                        onclick="showDisconnectModal()">‚ùå H·ªßy k·∫øt n·ªëi</button>
                </div>

                <p style="color: var(--text-muted); font-size: 13px; text-align: center;">
                    Ng∆∞·ªùi n√†y ƒëang theo d√µi s·ª©c kh·ªèe c·ªßa b·∫°n.<br>
                    B·∫°n c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh quy·ªÅn truy c·∫≠p c·ªßa h·ªç.
                </p>
            </div>
        </div>

        <!-- SCR-04B: Chi ti·∫øt ng∆∞·ªùi th√¢n - Tr·∫°ng th√°i PENDING (l·ªùi m·ªùi ƒëang ch·ªù) -->
        <div id="scr04b" class="screen">
            <div class="header">
                <span class="header-back" onclick="goToScreen('scr01')">‚Üê</span>
                <span class="header-title">Chi ti·∫øt ng∆∞·ªùi th√¢n</span>
            </div>
            <div class="content">
                <div class="detail-card">
                    <div class="detail-avatar">üë¥</div>
                    <div class="detail-name">B√°c Hai (Nguy·ªÖn VƒÉn H)</div>
                    <div class="detail-meta" style="color: var(--warning);">‚è≥ Ch·ªù ph·∫£n h·ªìi</div>
                    <div class="detail-meta">ƒê√£ g·ª≠i l·ªùi m·ªùi 2 gi·ªù tr∆∞·ªõc</div>
                </div>

                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-outline" style="flex: 1;" onclick="goToScreen('scr05')">‚öôÔ∏è Quy·ªÅn
                        truy c·∫≠p</button>
                    <button class="btn btn-outline" style="flex: 1; color: var(--danger);"
                        onclick="showCancelPendingModal('invite', 'B√°c Hai')">‚ùå H·ªßy l·ªùi m·ªùi</button>
                </div>

                <p style="color: var(--text-muted); font-size: 13px; text-align: center;">
                    L·ªùi m·ªùi ƒëang ch·ªù ph·∫£n h·ªìi.<br>
                    B·∫°n c√≥ th·ªÉ c·∫•u h√¨nh quy·ªÅn tr∆∞·ªõc ho·∫∑c h·ªßy l·ªùi m·ªùi.
                </p>
            </div>
        </div>

        <!-- SCR-05: Quy·ªÅn truy c·∫≠p -->
        <div id="scr05" class="screen">
            <div class="header">
                <span class="header-back" onclick="goToScreen('scr04')">‚Üê</span>
                <span class="header-title">Quy·ªÅn truy c·∫≠p</span>
            </div>
            <div class="content">
                <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">
                    Ch·ªçn quy·ªÅn m√† <strong>Con trai (Nguy·ªÖn VƒÉn B)</strong> ƒë∆∞·ª£c ph√©p truy c·∫≠p:
                </p>

                <div class="permission-list">
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Xem t·ªïng quan s·ª©c kh·ªèe</div>
                            <div class="permission-desc">Ch·ªâ s·ªë HA, b√°o c√°o</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Nh·∫≠n c·∫£nh b√°o kh·∫©n c·∫•p</div>
                            <div class="permission-desc">C·∫£nh b√°o HA b·∫•t th∆∞·ªùng, SOS</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this, true)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Thi·∫øt l·∫≠p nhi·ªám v·ª•</div>
                            <div class="permission-desc">T·∫°o/s·ª≠a nhi·ªám v·ª• tu√¢n th·ªß</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Theo d√µi k·∫øt qu·∫£</div>
                            <div class="permission-desc">Xem l·ªãch s·ª≠ tu√¢n th·ªß</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">Th·ª±c hi·ªán nhi·ªám v·ª• thay</div>
                            <div class="permission-desc">ƒê√°nh d·∫•u ho√†n th√†nh</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                    <div class="permission-item">
                        <div class="permission-info">
                            <div class="permission-name">G·ª≠i l·ªùi ƒë·ªông vi√™n</div>
                            <div class="permission-desc">G·ª≠i tin nh·∫Øn</div>
                        </div>
                        <div class="toggle on" onclick="togglePermission(this)"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCR-06: Chi ti·∫øt Patient (Caregiver View) -->
        <div id="scr06" class="screen">
            <div class="header">
                <span class="header-back" onclick="goToScreen('scr01')">‚Üê</span>
                <span class="header-title">Chi ti·∫øt Ng∆∞·ªùi th√¢n</span>
            </div>
            <div class="content">
                <div class="detail-card">
                    <div class="detail-avatar">üëµ</div>
                    <div class="detail-name">M·∫π (Tr·∫ßn Th·ªã D)</div>
                    <div class="detail-meta">Ho·∫°t ƒë·ªông 5 ph√∫t tr∆∞·ªõc</div>
                </div>

                <!-- Scope Note: Ch·ªâ basic info, Dashboard s·ª©c kh·ªèe s·∫Ω implement ·ªü SRS #2 -->
                <p
                    style="color: var(--text-secondary); text-align: center; margin: 24px 0; padding: 20px; background: var(--bg-gray); border-radius: var(--radius); font-size: 14px;">
                    üè• Dashboard s·ª©c kh·ªèe chi ti·∫øt<br>
                    <span style="color: var(--text-muted);">(S·∫Ω c√≥ trong phi√™n b·∫£n k·∫ø ti·∫øp)</span>
                </p>

                <button class="btn btn-outline" style="margin-top: 16px; color: var(--danger);"
                    onclick="showStopFollowModal()">
                    Ng·ª´ng theo d√µi
                </button>
            </div>
        </div>

        <!-- Modals -->
        <div class="modal" id="disconnectModal">
            <div class="modal-content">
                <div class="modal-icon">‚ö†Ô∏è</div>
                <div class="modal-title">X√°c nh·∫≠n h·ªßy k·∫øt n·ªëi?</div>
                <div class="modal-text">Sau khi h·ªßy, Con trai s·∫Ω kh√¥ng c√≤n theo d√µi s·ª©c kh·ªèe c·ªßa b·∫°n.</div>
                <div class="modal-buttons">
                    <button class="btn btn-outline" onclick="hideModal('disconnectModal')">Quay l·∫°i</button>
                    <button class="btn btn-danger" onclick="confirmDisconnect()">H·ªßy k·∫øt n·ªëi</button>
                </div>
            </div>
        </div>

        <div class="modal" id="permissionModal">
            <div class="modal-content">
                <div class="modal-icon" style="color: var(--danger);">‚ö†Ô∏è</div>
                <div class="modal-title">C·∫£nh b√°o quan tr·ªçng</div>
                <div class="modal-text">N·∫øu t·∫Øt, Con trai s·∫Ω <strong>KH√îNG</strong> nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o khi b·∫°n g·∫∑p nguy
                    hi·ªÉm. ƒêi·ªÅu n√†y c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn s·ª± an to√†n c·ªßa b·∫°n.</div>
                <div class="modal-buttons">
                    <button class="btn btn-outline"
                        onclick="hideModal('permissionModal'); currentToggle.classList.add('on');">Gi·ªØ nguy√™n</button>
                    <button class="btn btn-danger" onclick="hideModal('permissionModal');">V·∫´n t·∫Øt</button>
                </div>
            </div>
        </div>

        <div class="modal" id="stopFollowModal">
            <div class="modal-content">
                <div class="modal-icon">‚ö†Ô∏è</div>
                <div class="modal-title">Ng·ª´ng theo d√µi?</div>
                <div class="modal-text">B·∫°n s·∫Ω kh√¥ng c√≤n theo d√µi s·ª©c kh·ªèe c·ªßa M·∫π n·ªØa.</div>
                <div class="modal-buttons">
                    <button class="btn btn-outline" onclick="hideModal('stopFollowModal')">Quay l·∫°i</button>
                    <button class="btn btn-danger" onclick="confirmStopFollow()">Ng·ª´ng theo d√µi</button>
                </div>
            </div>
        </div>

        <div class="modal" id="confirmPermissionModal">
            <div class="modal-content">
                <div class="modal-icon">üîê</div>
                <div class="modal-title">X√°c nh·∫≠n thay ƒë·ªïi quy·ªÅn</div>
                <div class="modal-text" id="confirmPermissionText">B·∫°n c√≥ ch·∫Øc mu·ªën T·∫ÆT quy·ªÅn n√†y cho Con trai?</div>
                <div class="modal-buttons">
                    <button class="btn btn-outline"
                        onclick="hideModal('confirmPermissionModal'); currentToggle.classList.add('on');">Kh√¥ng</button>
                    <button class="btn btn-primary"
                        onclick="hideModal('confirmPermissionModal'); showToast('ƒê√£ c·∫≠p nh·∫≠t quy·ªÅn');">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>

        <!-- MISS-01: Modal for B2.3 - Patient declined Caregiver follow request -->
        <div class="modal" id="followDeclinedModal">
            <div class="modal-content">
                <div class="modal-icon" style="color: var(--danger);">üö´</div>
                <div class="modal-title">Kh√¥ng c√≥ quy·ªÅn theo d√µi</div>
                <div class="modal-text">Ng∆∞·ªùi n√†y ƒë√£ t·ª´ ch·ªëi cho b·∫°n theo d√µi s·ª©c kh·ªèe c·ªßa h·ªç.</div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="hideModal('followDeclinedModal'); goToScreen('scr01');">ƒê√£
                        hi·ªÉu</button>
                </div>
            </div>
        </div>

        <!-- Accept Invite Confirm Modal (B2.1) -->
        <div class="modal" id="acceptInviteModal">
            <div class="modal-content">
                <div class="modal-icon">‚úì</div>
                <div class="modal-title">Ch·∫•p nh·∫≠n l·ªùi m·ªùi</div>
                <div class="modal-text" id="acceptInviteText">Ch·∫•p nh·∫≠n l·ªùi m·ªùi t·ª´ ng∆∞·ªùi n√†y?</div>
                <div class="modal-buttons">
                    <button class="btn btn-outline" onclick="hideModal('acceptInviteModal')">Quay l·∫°i</button>
                    <button class="btn btn-primary" onclick="confirmAcceptInvite()">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>

        <!-- Reject Invite Confirm Modal (A2.2, B2.2) -->
        <div class="modal" id="rejectInviteModal">
            <div class="modal-content">
                <div class="modal-icon" style="color: var(--danger);">‚úó</div>
                <div class="modal-title">X√°c nh·∫≠n t·ª´ ch·ªëi</div>
                <div class="modal-text" id="rejectInviteText">T·ª´ ch·ªëi l·ªùi m·ªùi t·ª´ ng∆∞·ªùi n√†y?</div>
                <div class="modal-buttons">
                    <button class="btn btn-outline" onclick="hideModal('rejectInviteModal')">Quay l·∫°i</button>
                    <button class="btn btn-danger" onclick="confirmRejectInvite()">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>

        <!-- Cancel Pending Invite Modal (A3.2b, B3.2b) -->
        <div class="modal" id="cancelPendingModal">
            <div class="modal-content">
                <div class="modal-icon" style="color: var(--warning);">‚è≥</div>
                <div class="modal-title" id="cancelPendingTitle">H·ªßy l·ªùi m·ªùi</div>
                <div class="modal-text" id="cancelPendingText">H·ªßy l·ªùi m·ªùi ƒë·∫øn ng∆∞·ªùi n√†y?</div>
                <div class="modal-buttons">
                    <button class="btn btn-outline" onclick="hideModal('cancelPendingModal')">Quay l·∫°i</button>
                    <button class="btn btn-danger" onclick="confirmCancelPending()">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div class="toast" id="toast"></div>
    </div>

    <script>
        let currentToggle = null;
        let selectedPatient = null;

        // Profile Selection Logic - Auto-select and Persistence
        function initProfileSelector() {
            // Check localStorage for saved selection
            const saved = localStorage.getItem('selectedPatient');
            if (saved) {
                try {
                    selectedPatient = JSON.parse(saved);
                    updateProfileSelector(selectedPatient);
                } catch (e) {
                    // Fallback: auto-select first patient if list has items
                    autoSelectFirstPatient();
                }
            } else {
                // First time: auto-select first patient if available
                autoSelectFirstPatient();
            }
        }

        function autoSelectFirstPatient() {
            // Simulate: list "T√¥i ƒëang theo d√µi" has 1 patient
            const hasPatients = true; // In real app: check API
            if (hasPatients) {
                selectPatient('mom', 'üëµ', 'M·∫π (Tr·∫ßn Th·ªã D)', 'Ho·∫°t ƒë·ªông 5 ph√∫t tr∆∞·ªõc');
            }
        }

        function selectPatient(id, avatar, name, lastActive) {
            selectedPatient = { id, avatar, name, lastActive };
            localStorage.setItem('selectedPatient', JSON.stringify(selectedPatient));
            updateProfileSelector(selectedPatient);
            hideDropdown();
        }

        function updateProfileSelector(patient) {
            const profileAvatar = document.querySelector('.profile-avatar');
            const profileName = document.querySelector('.profile-name');
            const profileStatus = document.querySelector('.profile-status');

            if (patient) {
                // State E: ƒê√£ ch·ªçn Patient
                profileAvatar.textContent = patient.avatar;
                profileName.innerHTML = patient.name + ' <span class="dropdown-arrow">‚ñº</span>';
                profileStatus.textContent = patient.lastActive;
            } else {
                // Fallback: State A/B/C/D based on counts
                updateProfileStatus();
            }
        }

        function updateProfileStatus() {
            const profileStatus = document.querySelector('.profile-status');
            const profileAvatar = document.querySelector('.profile-avatar');
            const profileName = document.querySelector('.profile-name');

            // Simulated counts (in real app: from API)
            const followingCount = 1; // "T√¥i ƒëang theo d√µi"
            const followersCount = 2; // "Ng∆∞·ªùi theo d√µi t√¥i"

            profileAvatar.textContent = 'üë§';
            profileName.innerHTML = 'T√†i kho·∫£n c·ªßa [Danh x∆∞ng] <span class="dropdown-arrow">‚ñº</span>';

            if (followingCount > 0 && followersCount > 0) {
                // State A: C√≥ c·∫£ 2
                profileStatus.textContent = followersCount + ' ng∆∞·ªùi theo d√µi, theo d√µi ' + followingCount + ' ng∆∞·ªùi';
            } else if (followersCount > 0) {
                // State B: Ch·ªâ c√≥ ng∆∞·ªùi theo d√µi
                profileStatus.textContent = followersCount + ' ng∆∞·ªùi theo d√µi';
            } else if (followingCount > 0) {
                // State C: Ch·ªâ b·∫°n theo d√µi
                profileStatus.textContent = 'Theo d√µi ' + followingCount + ' ng∆∞·ªùi';
            } else {
                // State D: Kh√¥ng c√≥ ai
                profileStatus.textContent = 'Ch∆∞a c√≥ k·∫øt n·ªëi n√†o';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initProfileSelector);

        function goToScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            hideDropdown();
        }

        function toggleBottomSheet() {
            const sheet = document.getElementById('bottomSheet');
            const overlay = document.getElementById('sheetOverlay');
            const isOpen = sheet.classList.contains('show');

            if (isOpen) {
                sheet.classList.remove('show');
                overlay.classList.remove('show');
            } else {
                sheet.style.display = 'block';
                overlay.style.display = 'block';
                // Trigger reflow for animation
                sheet.offsetHeight;
                sheet.classList.add('show');
                overlay.classList.add('show');
            }
        }

        function hideBottomSheet() {
            document.getElementById('bottomSheet').classList.remove('show');
            document.getElementById('sheetOverlay').classList.remove('show');
            setTimeout(() => {
                document.getElementById('bottomSheet').style.display = 'none';
                document.getElementById('sheetOverlay').style.display = 'none';
            }, 300);
        }

        // Legacy alias for compatibility
        function hideDropdown() {
            hideBottomSheet();
        }

        function showInviteSheet(type) {
            // Hide the connection list sheet first
            hideBottomSheet();

            setTimeout(() => {
                const inviteSheet = document.getElementById('inviteSheet');
                const inviteOverlay = document.getElementById('inviteSheetOverlay');
                const title = document.getElementById('inviteSheetTitle');
                const desc = document.getElementById('inviteSheetDesc');

                if (type === 'follow') {
                    title.textContent = 'Theo d√µi ng∆∞·ªùi th√¢n';
                    desc.textContent = 'Nh·∫≠p th√¥ng tin ng∆∞·ªùi b·∫°n mu·ªën theo d√µi s·ª©c kh·ªèe.';
                } else {
                    title.textContent = 'M·ªùi ng∆∞·ªùi th√¢n theo d√µi';
                    desc.textContent = 'Nh·∫≠p th√¥ng tin ng∆∞·ªùi b·∫°n mu·ªën m·ªùi theo d√µi s·ª©c kh·ªèe c·ªßa b·∫°n.';
                }

                // Store invite type
                inviteSheet.dataset.type = type;

                // Show invite sheet
                inviteSheet.style.display = 'block';
                inviteOverlay.style.display = 'block';
                inviteSheet.offsetHeight;
                inviteSheet.classList.add('show');
                inviteOverlay.classList.add('show');
            }, 350);
        }

        function backToInviteSheet() {
            // Go back to SCR-01 and show invite sheet with preserved data
            goToScreen('scr01');
            setTimeout(() => {
                // Restore saved invite data
                const savedData = localStorage.getItem('pendingInvite');
                if (savedData) {
                    const { name, phone, relationship, type } = JSON.parse(savedData);

                    // Show the correct sheet type
                    const inviteSheet = document.getElementById('inviteSheet');
                    const inviteOverlay = document.getElementById('inviteSheetOverlay');
                    const title = document.getElementById('inviteSheetTitle');
                    const desc = document.getElementById('inviteSheetDesc');

                    if (type === 'follow') {
                        title.textContent = 'Theo d√µi ng∆∞·ªùi th√¢n';
                        desc.textContent = 'Nh·∫≠p th√¥ng tin ng∆∞·ªùi b·∫°n mu·ªën theo d√µi s·ª©c kh·ªèe.';
                    } else {
                        title.textContent = 'M·ªùi ng∆∞·ªùi th√¢n theo d√µi';
                        desc.textContent = 'Nh·∫≠p th√¥ng tin ng∆∞·ªùi b·∫°n mu·ªën m·ªùi theo d√µi s·ª©c kh·ªèe c·ªßa b·∫°n.';
                    }
                    inviteSheet.dataset.type = type;

                    // Show sheet
                    inviteSheet.style.display = 'block';
                    inviteOverlay.style.display = 'block';
                    inviteSheet.offsetHeight;
                    inviteSheet.classList.add('show');
                    inviteOverlay.classList.add('show');

                    // Restore form values after sheet is shown
                    setTimeout(() => {
                        document.getElementById('inviteNameInput').value = name || '';
                        document.getElementById('invitePhoneInput').value = phone || '';
                        document.getElementById('inviteRelationship').value = relationship || '';
                        validateInviteForm();
                    }, 100);
                } else {
                    showInviteSheet('invite');
                }
            }, 300);
        }

        function hideInviteSheet() {
            document.getElementById('inviteSheet').classList.remove('show');
            document.getElementById('inviteSheetOverlay').classList.remove('show');
            setTimeout(() => {
                document.getElementById('inviteSheet').style.display = 'none';
                document.getElementById('inviteSheetOverlay').style.display = 'none';
                // Reset form
                document.getElementById('inviteForm').reset();
                document.getElementById('inviteSubmitBtn').disabled = true;
            }, 300);
        }

        function validateInviteForm() {
            const name = document.getElementById('inviteNameInput').value.trim();
            const phone = document.getElementById('invitePhoneInput').value.trim();
            const relationship = document.getElementById('inviteRelationship').value;
            const btn = document.getElementById('inviteSubmitBtn');
            const nameInput = document.getElementById('inviteNameInput');
            const nameError = document.getElementById('nameError');
            const phoneInput = document.getElementById('invitePhoneInput');
            const phoneError = document.getElementById('phoneError');
            const isPhoneValid = /^0[0-9]{9}$/.test(phone);

            // Name validation (MISS-03)
            if (name.length > 0 && name.length < 2) {
                nameInput.classList.add('error');
                nameError.classList.add('show');
            } else {
                nameInput.classList.remove('error');
                nameError.classList.remove('show');
            }

            // Phone validation - show error when has input but invalid
            if (phone.length > 0 && !isPhoneValid) {
                phoneInput.classList.add('error');
                phoneError.classList.add('show');
            } else {
                phoneInput.classList.remove('error');
                phoneError.classList.remove('show');
            }

            btn.disabled = !(name.length >= 2 && isPhoneValid && relationship);
        }

        function submitInvite() {
            const name = document.getElementById('inviteNameInput').value.trim();
            const phone = document.getElementById('invitePhoneInput').value.trim();
            const relationship = document.getElementById('inviteRelationship').value;
            const type = document.getElementById('inviteSheet').dataset.type;

            // Edge case checks
            if (phone === '0912000000') {
                showToast('‚ùå B·∫°n kh√¥ng th·ªÉ m·ªùi ch√≠nh m√¨nh');
                return;
            }
            if (phone === '0912111111') {
                showToast('‚ùå B·∫°n ƒë√£ k·∫øt n·ªëi v·ªõi ng∆∞·ªùi n√†y');
                return;
            }
            if (phone === '0912222222') {
                showToast('‚è≥ B·∫°n ƒë√£ g·ª≠i l·ªùi m·ªùi. ƒêang ch·ªù ph·∫£n h·ªìi.');
                return;
            }
            // MISS-01 (B2.3): Patient declined Caregiver's follow request
            if (phone === '0912333333' && type === 'follow') {
                hideInviteSheet();
                setTimeout(() => showModal('followDeclinedModal'), 400);
                return;
            }

            hideInviteSheet();

            // Both flows go to permission config
            localStorage.setItem('pendingInvite', JSON.stringify({ name, phone, relationship, type }));
            setTimeout(() => goToScreen('scr02b-permissions'), 350);
        }

        // Multi-invite tracking
        let pendingInvites = ['chu-ut', 'co-ba', 'anh-hai'];
        const inviteNames = {
            'chu-ut': 'Ch√∫ √öt',
            'co-ba': 'C√¥ Ba',
            'anh-hai': 'Anh Hai'
        };

        // Current invite being processed
        let currentAcceptingInvite = null;

        function acceptInvite(id, inviteType) {
            // Store current invite for later processing
            currentAcceptingInvite = id;
            currentAcceptingType = inviteType;

            if (inviteType === 'follow-them') {
                // B2.1: Show confirmation popup first (per SRS)
                document.getElementById('acceptInviteText').textContent =
                    'Ch·∫•p nh·∫≠n l·ªùi m·ªùi t·ª´ ' + inviteNames[id] + '?';
                showModal('acceptInviteModal');
            } else {
                // A2.1: Patient accepts Caregiver's invite - NEED permission config
                document.getElementById('acceptingInviterName').textContent = inviteNames[id];
                goToScreen('scr02b-accept');
            }
        }

        let currentAcceptingType = null;

        function confirmAcceptInvite() {
            hideModal('acceptInviteModal');
            if (!currentAcceptingInvite) return;
            directAcceptInvite(currentAcceptingInvite);
        }

        function directAcceptInvite(id) {
            // Remove from pending list
            pendingInvites = pendingInvites.filter(i => i !== id);

            // Remove the invite item from DOM
            const inviteItems = document.querySelectorAll('#inviteBlock .invite-item');
            inviteItems.forEach(item => {
                if (item.querySelector('.btn-accept')?.onclick?.toString().includes(id)) {
                    item.remove();
                }
            });

            // Update badge count
            updateInviteBadge();

            showToast('‚úÖ ƒê√£ k·∫øt n·ªëi v·ªõi ' + inviteNames[id] + '. B·∫°n c√≥ th·ªÉ theo d√µi s·ª©c kh·ªèe c·ªßa h·ªç.');
            currentAcceptingInvite = null;
        }

        function cancelAcceptInvite() {
            // Go back without accepting
            currentAcceptingInvite = null;
            goToScreen('scr01');
        }

        function confirmAcceptWithPermissions() {
            if (!currentAcceptingInvite) return;

            const id = currentAcceptingInvite;

            // Remove from pending list
            pendingInvites = pendingInvites.filter(i => i !== id);

            // Remove the invite item from DOM
            const inviteItems = document.querySelectorAll('#inviteBlock .invite-item');
            inviteItems.forEach(item => {
                if (item.querySelector('.btn-accept')?.onclick?.toString().includes(id)) {
                    item.remove();
                }
            });

            // Update badge count
            updateInviteBadge();

            currentAcceptingInvite = null;
            showToast('‚úÖ ƒê√£ k·∫øt n·ªëi v·ªõi ' + inviteNames[id] + '!');
            goToScreen('scr01');
        }

        function quickAcceptAll() {
            // A2.1b: Quick accept with all permissions ON
            confirmAcceptWithPermissions();
        }

        // Current invite being rejected
        let currentRejectingInvite = null;

        function rejectInvite(id) {
            // Show confirm modal first
            currentRejectingInvite = id;
            document.getElementById('rejectInviteText').textContent =
                'T·ª´ ch·ªëi l·ªùi m·ªùi t·ª´ ' + inviteNames[id] + '?';
            showModal('rejectInviteModal');
        }

        function confirmRejectInvite() {
            hideModal('rejectInviteModal');
            const id = currentRejectingInvite;

            // Remove from pending list
            pendingInvites = pendingInvites.filter(i => i !== id);

            // Hide the specific invite item
            document.querySelectorAll('.invite-item').forEach(item => {
                if (item.querySelector('.btn-reject')?.onclick?.toString().includes(id)) {
                    item.remove();
                }
            });

            // Update badge count
            updateInviteBadge();

            showToast('ƒê√£ t·ª´ ch·ªëi l·ªùi m·ªùi t·ª´ ' + inviteNames[id]);
            currentRejectingInvite = null;
        }

        function updateInviteBadge() {
            const count = pendingInvites.length;
            const header = document.querySelector('.invite-header');
            const badge = document.querySelector('.nav-badge');

            if (count === 0) {
                document.getElementById('inviteBlock').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
                if (badge) badge.classList.remove('nav-badge');
            } else {
                header.textContent = 'üì¨ L·ªùi m·ªùi m·ªõi (' + count + ')';
                // Update badge number via CSS would need ::after content change
            }
        }

        // Cancel pending invite/follow modal logic
        let currentCancelType = null;
        let currentCancelName = null;

        function showCancelPendingModal(type, name) {
            currentCancelType = type;
            currentCancelName = name;

            if (type === 'invite') {
                document.getElementById('cancelPendingTitle').textContent = 'H·ªßy l·ªùi m·ªùi';
                document.getElementById('cancelPendingText').textContent = 'H·ªßy l·ªùi m·ªùi ƒë·∫øn ' + name + '?';
            } else {
                document.getElementById('cancelPendingTitle').textContent = 'H·ªßy y√™u c·∫ßu';
                document.getElementById('cancelPendingText').textContent = 'H·ªßy y√™u c·∫ßu theo d√µi ' + name + '?';
            }
            showModal('cancelPendingModal');
        }

        function confirmCancelPending() {
            hideModal('cancelPendingModal');

            if (currentCancelType === 'invite') {
                // Remove from "Ng∆∞·ªùi ƒëang theo d√µi t√¥i" section
                const sections = document.querySelectorAll('.dropdown-section');
                sections[1]?.querySelector('.dropdown-item.pending')?.remove();
                document.querySelectorAll('.dropdown-section-title').forEach(title => {
                    if (title.textContent.includes('Ng∆∞·ªùi ƒëang theo d√µi t√¥i')) {
                        title.textContent = 'üìã Ng∆∞·ªùi ƒëang theo d√µi t√¥i (2)';
                    }
                });
                showToast('‚úÖ ƒê√£ h·ªßy l·ªùi m·ªùi');
            } else {
                // Remove from "T√¥i ƒëang theo d√µi" section
                const sections = document.querySelectorAll('.dropdown-section');
                sections[0]?.querySelector('.dropdown-item.pending')?.remove();
                document.querySelectorAll('.dropdown-section-title').forEach(title => {
                    if (title.textContent.includes('T√¥i ƒëang theo d√µi')) {
                        title.textContent = 'üìã T√¥i ƒëang theo d√µi (1)';
                    }
                });
                showToast('‚úÖ ƒê√£ h·ªßy y√™u c·∫ßu theo d√µi');
            }

            toggleBottomSheet();
            currentCancelType = null;
            currentCancelName = null;
        }

        // Legacy functions (kept for compatibility)
        function showCancelInviteModal() {
            showCancelPendingModal('invite', 'B√°c Hai');
        }

        function showCancelFollowModal() {
            showCancelPendingModal('follow', 'D√¨ Ba');
        }

        function validatePhone(input, errorId, btnId) {
            const phone = input.value;
            const isValid = /^0[0-9]{9}$/.test(phone);
            const errorEl = document.getElementById(errorId);
            const btnEl = document.getElementById(btnId);

            if (phone.length === 10 && !isValid) {
                input.classList.add('error');
                errorEl.classList.add('show');
                btnEl.disabled = true;
            } else {
                input.classList.remove('error');
                errorEl.classList.remove('show');
                btnEl.disabled = !isValid;
            }
        }

        function goToPermissionConfig() {
            // Save phone number temporarily, then go to permissions config
            const phone = document.getElementById('phoneInput1').value;
            localStorage.setItem('pendingInvitePhone', phone);
            goToScreen('scr02b-permissions');
        }

        function sendInviteWithPermissions() {
            const phone = localStorage.getItem('pendingInvitePhone');

            // Edge case A1.3: Self-invite
            if (phone === '0912000000') {
                showToast('‚ùå B·∫°n kh√¥ng th·ªÉ m·ªùi ch√≠nh m√¨nh');
                return;
            }
            // Edge case A1.4: Already connected
            if (phone === '0912111111') {
                showToast('‚ùå B·∫°n ƒë√£ k·∫øt n·ªëi v·ªõi ng∆∞·ªùi n√†y');
                return;
            }
            // Edge case A1.5: Pending invite exists
            if (phone === '0912222222') {
                showToast('‚è≥ B·∫°n ƒë√£ g·ª≠i l·ªùi m·ªùi. ƒêang ch·ªù ph·∫£n h·ªìi.');
                return;
            }

            localStorage.removeItem('pendingInvitePhone');
            showToast('‚úÖ ƒê√£ g·ª≠i l·ªùi m·ªùi th√†nh c√¥ng!');
            setTimeout(() => goToScreen('scr01'), 1500);
        }

        function sendInvite(type) {
            const phoneInput = type === 'invite' ? document.getElementById('phoneInput1') : document.getElementById('phoneInput2');
            const phone = phoneInput.value;

            // Edge case A1.3: Self-invite
            if (phone === '0912000000') {
                showToast('‚ùå B·∫°n kh√¥ng th·ªÉ m·ªùi ch√≠nh m√¨nh');
                return;
            }
            // Edge case A1.4: Already connected
            if (phone === '0912111111') {
                showToast('‚ùå B·∫°n ƒë√£ k·∫øt n·ªëi v·ªõi ng∆∞·ªùi n√†y');
                return;
            }
            // Edge case A1.5: Pending invite exists
            if (phone === '0912222222') {
                showToast('‚è≥ B·∫°n ƒë√£ g·ª≠i l·ªùi m·ªùi. ƒêang ch·ªù ph·∫£n h·ªìi.');
                return;
            }

            showToast('‚úÖ ƒê√£ g·ª≠i l·ªùi m·ªùi th√†nh c√¥ng!');
            setTimeout(() => goToScreen('scr01'), 1500);
        }

        function togglePermission(el, isCritical = false) {
            currentToggle = el;
            const wasOn = el.classList.contains('on');

            if (wasOn) {
                el.classList.remove('on');
                if (isCritical) {
                    showModal('permissionModal');
                } else {
                    showModal('confirmPermissionModal');
                }
            } else {
                el.classList.add('on');
                showToast('ƒê√£ b·∫≠t quy·ªÅn');
            }
        }

        function showModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function hideModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        function showDisconnectModal() {
            showModal('disconnectModal');
        }

        function confirmDisconnect() {
            hideModal('disconnectModal');
            showToast('ƒê√£ h·ªßy k·∫øt n·ªëi v·ªõi Con trai');
            setTimeout(() => goToScreen('scr01'), 1500);
        }

        function showStopFollowModal() {
            showModal('stopFollowModal');
        }

        function confirmStopFollow() {
            hideModal('stopFollowModal');
            showToast('ƒê√£ ng·ª´ng theo d√µi M·∫π');
            setTimeout(() => goToScreen('scr01'), 1500);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }
    </script>
</body>

</html>